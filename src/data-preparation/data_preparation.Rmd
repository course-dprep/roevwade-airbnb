---
title: "Data preparation"
output: html_document
date: '2022-09-18'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
## Load packages
library(dplyr)
library(googlesheets4)

 
## Importing Google Sheet as CSV in R.
gs4_deauth()
df <- read_sheet("https://docs.google.com/spreadsheets/d/1tOMjx-lflqp-9XC1iGc9tdBIfK-nrOdlsLnFGgLFdVA/edit#gid=0")
df
head(df)
url <- as.character(df$url)
 
 
## Reading datasets for all cities
tbl <- lapply(url, function(url) {
  print(paste0('Now downloading ... ', url))
  d <- read.csv(url)
  city = tolower(as.character(df$city[match(url, df$url)]))
  d$city <- city
  states = as.character(df$states[match(url, df$url)])
  d$states <- states
  time = df$time[match(url, df$url)]
  d$time <- time
  category = df$category[match(url, df$url)]
  d$category <- category
  return(d)
})
```


```{r}
## Combining data into a single data frame
combined_data = do.call('rbind', tbl)
head(combined_data)
glimpse(combined_data)
combined_data1 <- subset(combined_data, select = c(3, 10, 19:22))
head(combined_data1)
glimpse(combined_data1)
```
```{r}
library(tidyverse)
## Create a dummy variable to identify the states where abortion is legal or not after overturning Roe v wade.  example lets assumed that countries with code 5,6, and 7 were treated (=1). states has the category "Legal" and "Gestational Limit" (abortion is banned after >= 15 weeks of pregnancy) are treated as "legal" (=0); states has the category "Banned" are treated as "banned"(=1) in our analysis. 
combined_data1$category1 <- ifelse(combined_data1$category == "Legal", 0, 1)
head(combined_data1)
## Create an interaction between time and category1. We will call this interaction 'did'
combined_data1$did <- combined_data1$time * combined_data1$category1
```

```{r}
# Estimating the DID estimator
didreg = lm(price ~ category1 + time + did, data = combined_data1)
summary(didreg)
```

```{r}
## Estimating the DID estimator
didreg1 = lm(price ~ category1*time, data = combined_data1)
summary(didreg1)
```




```{r}

```

```{r}


```


```{r}

```

